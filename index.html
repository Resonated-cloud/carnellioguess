<!DOCTYPE HTML>
<title>hi</title>
<center>
<h1>guess carnellio combo thing</h1>
<h2>BOSS : Carnellio</h2>
<p id=healthbar>Health : <span id = "health">12550000</span><br>
<h2 id=dialogue style="color: #5d00ff;"></h2><br>
<img src = "images/CARNELLIO.webp" width = "100" height = "100">
<div id = "imgattack">
</div>
<p>What's this attack called?</p>
<p id="timerlabel"><span id = "timer">160</span><span id="timerstatus"></span><span id="ES"></span></p>
</center>
<p id="lifecounter">Life: <span id="life1">5</span> / <span id="life2">5</span><span id="lifenews"></span><span id="statuseffect"></span></p> 
<center>
<p id="confirm">Current combo: </p>
<div id="answer">
<p id="atk" style="color: #5d00ff;"> </p>
</div>
<p id="msgthing"><span id="msg"></span><span id="damageshow"></span><span id="damagemultishow"></span></p>
<button id = "send" onclick="check()">Send</button>
<button id = "Backspace" onclick="backspace()">Backspace</button>
<button id = "clear" onclick="clearcombo()">Clear All</button>
<button id = "phasetest" onclick="damagecarn(1640000)">Phase 2 damage thing</button>
<br></br>
<button id ="SS" onclick="attack('Sweeping Seize', 'SS')">Sweeping Seize</button>
<button id ="Decap" onclick="attack('Decapitate', 'Decap')">Decapitate</button>
<button id ="VV" onclick="attack('Violet Viper', 'VV')">Violet Viper</button>
<button id ="Fakeout" onclick="attack('Fakeout', 'Fakeout')">Fakeout</button>
<button id ="Dash" onclick="attack('Dash', 'Dash')">Dash</button>
<button id ="TR" onclick="attack('Tyrant Revolver', 'TR')">Tyrant Revolver</button>
<button id ="WF" onclick="attack('Wandering Flame', 'WF')">Wandering Flame</button>
<br></br>
<p id = "phase2text" style="display: none";>Phase 2 Attacks :</p>
<button id ="SV" style="display: none"; onclick="attack('Shadow Viper', 'SV')">Shadow Viper</button>
<button id ="SF" style="display: none"; onclick="attack('Shadow Flame', 'SF')">Shadow Flame</button>
<button id ="DS" style="display: none"; onclick="attack('Deadspike', 'DS')">Deadspike</button>
<button id ="DR" style="display: none"; onclick="attack('Dark Revolver', 'DR')">Dark Revolver</button><br></br>
<p id = "phase3text" style="display: none";>Phase 3 Attacks :</p>
<button id ="Summon" style="display: none"; onclick="attack('Summon', 'Summon')">Summon</button>
<button id ="Redirect" style="display: none"; onclick="attack('Redirect', 'Redirect')">Redirect</button>
<button id ="BD" style="display: none"; onclick="attack('Black Divinity', 'BD')">Black Divinity</button>
<button id ="Romeida" style="display: none"; onclick="attack('Romeida', 'Romeida')">Romeida</button>
<button id ="Mawaru" style="display: none"; onclick="attack('Mawaru', 'Mawaru')">Mawaru</button>
<br></br>
<p id = "phase4text" style="display: none";>Phase 4 Attacks :</p>
<button id ="DB" style="display: none"; onclick="attack('Dragon Bullet', 'DB')">Dragon Bullet</button>
<button id ="ES" style="display: none"; onclick="attack('Evening Shade', 'ES')">Evening Shade</button>
<button id ="SR" style="display: none; color:"#5d00c8"; onclick="attack('Shadow Riposte', 'SR')">Shadow Riposte</button>
<button id ="EF" style="display: none"; onclick="attack('Evil Fracture', 'EF')">Evil Fracture</button>
</html>


<script>
let statusEffects = {
    burn: null,   // stores remaining seconds for burn
    venom: null, // stores remaining seconds for poison
    freeze: null  // etc.
};
let extralife = 0;
let SRcd = false;
let damagedisplay = document.getElementById("damageshow");
let damagemultidisplay = document.getElementById("damagemultishow");
let damagemultiplier = 0;
let damage = 0;
let lifelost = 0;
let venom = 0;
let burnduration = 0;

let timerP = 160;
let phasechange2;
let phasechange3;
let phasechange4;
let guessattempt = false;
let p4initial;
let intervalP = 1000;
let intervalId3;
let dialogue = document.getElementById("dialogue");
let health = document.getElementById("health");
let healthval = health.textContent;

	
let ESlabel = document.getElementById("ES");
let ESFarstate = false;
let ESNearstate = false;
let ESpara = 1;
let ESduration = 0;
	
let phase = 1;
let state = "right";

let lifenews = document.getElementById("lifenews");
let lifenumber = document.getElementById("life1");
let statuseffect = document.getElementById("statuseffect");
let msg = document.getElementById("msg");
let lifecounter = document.getElementById("lifecounter");


let counter = false;
let guess = [];
/// p1 combos
const p1Combos = {A : ["SS", "Decap"], B : ["VV", "Decap"], C : ["Fakeout", "SS"], D : ["Fakeout", "TR"], E : ["Dash", "WF"], F : ["WF", "Dash"]};
const p2Combos = {A : ["SV", "DR"], B: ["SS", "SV", "DS"], C: ["DS", "VV"], D: ["VV", "SF"], E: ["Fakeout", "DS"], F : ["DR", "DS"], G: ["TR", "Decap"], H: ["SF", "TR"], I: ["Dash", "SF"], J: ["Dash", "SF", "WF"]};
const p3Combos = {A : ["Summon", "SS", "Romeida", "SV", "DS"], B: ["Summon", "Mawaru", "Redirect", "BD"], C: ["Summon", "SF", "Mawaru", "DS"], D: ["Summon", "Mawaru", "Romeida", "VV"], E: ["VV", "Dash", "SS", "DS"], F: ["SS", "SV", "DR", "DS"], G: ["Summon", "SF", "Mawaru", "Redirect", "BD"], H: ["Summon", "SF", "Redirect", "BD"], I: ["Summon", "Mawaru", "Redirect", "Romeida"], J: ["Dash", "DR", "SV", "DS"], K: ["SF", "DR", "DS", "Fakeout"]};
const p4Combos = {A : ["SS", "SV", "DR", "SV", "DS"], B : ["Dash", "Summon", "Redirect", "Romeida", "SR"], C: ["Fakeout", "DS", "Summon", "EF", "VV"], D:["Fakeout", "VV", "Summon", "Redirect", "Romeida"], E:["Summon", "EF", "Decap", "Dash", "SR"], F:["Summon", "SS", "SV", "DR", "SV", "ES"], G:["VV", "Summon", "DB", "BD", "WF"], H:["Dash", "Summon", "SF", "DB", "Romeida"], I:["Fakeout", "Summon", "SF", "ES", "SR"], J:["SF", "Summon", "DB", "Redirect", "ES", "SR"], K:["Summon", "Mawaru", "Romeida", "Summon", "DB", "BD"], L:["Summon", "DR", "SV", "DB", "ES"], M:["SF", "Summon", "Mawaru", "Redirect", "EF"], N:["TR", "SS", "SV", "DR", "DS"]}
const p4Initials = {A : ["Dash", "Fakeout", "VV", "Summon", "Mawaru", "Redirect", "DB", "ES", "SR"]}
let ans = 0;
///
let lnumber = document.getElementById("life1").textContent; /// its life number.. but number.. so lifenumbernumber??
let currentCombo;
let atk = document.getElementById("atk").textContent;
///
let timer = document.getElementById("timer").textContent;
let intervalId;
let intervalId2;

function timerloop(){ intervalId = setInterval(timedisplay, 1000);
} 
function timedisplay(){
if (timer <= 1){
clearInterval(intervalId);
final();
}
timer -= 10;
document.getElementById("timer").textContent = timer/10;
}
timerloop();

/// special attacks ///
function EvilFracture (){
	intervalId4 = setInterval(timefracturing, 100);
} 


function ShadowRiposte (){
counter = true;
dialogue.textContent = "Without a trace...";
setTimeout(function() {
dialogue.textContent = "";
counter = false;
}, 5000)
}
// SR counterattack
function Counterattack (){
SRcd = true;
counter = false;
dialogue.textContent = "End of days,"
setTimeout(function(){
dialogue.textContent = "Shadow Riposte!";
lnumber -= 2;
lifenumber.textContent = lnumber;
lifenews.style.color = "#5d00c8";
lifenews.textContent = " Counterattacked! (-2 lives)";
}, 1500);
setTimeout(function() {
lifenews.textContent = "";
SRcd = false;
dialogue.textContent = ""
}, 3500)
}

function burnfunction(life){
return; ////////// too lazy to work on this ill remake the status effects into array

damage = life * 0.5;
lifecounter.style.color = "#d25e19";
burnduration = 10;
statuseffect.textContent += " Burned! (-0.5 extra life after " + burnduration + " seconds)";
burn();
}



function burn(){ intervalId3 = setInterval(burndurations, 1000);
} 
function burndurations(){
if (burnduration === 1){
clearInterval(intervalId3);
lifelost += damage;
}
burnduration--;
document.getElementById("statuseffect").textContent = " Burned! (-0.5 extra life after " + burnduration + " seconds)";
}

burnfunction(1);
function venomfunction(duration){
lifecounter.style.color = "#00490c";
statuseffect.textContent += " Poisoned! (-1 extra life if the next guess is wrong)"
venom =+ duration;
}

function cleanse(){
if (venom !== 1){
venom--;
}
else{
venom--;
lifecounter.style.color = "#000000"
statuseffect.textContent = ""; //////////// MAKE SURE TO CHANGE THIS SO IT CAN WORK WITH OTHER EFFECTS
}

}

function EveningShade(){
	if (currentCombo.includes("ES")){
	ESduration = 3;
	ESpara++;
	}
	else if (ESduration == 0){
	ESNearstate = false;
	ESFarstate = false;
	ESlabel.textContent = "";
	return;
	}
if (ESpara % 2 == 1){
	ESFarstate = true;
	ESlabel.textContent = "  'Dawn's Strike' - Combos are locked to far combos for " + ESduration+" combos";
}
else{
	ESNearstate = true;
	ESlabel.textContent = "  'Dusk's Assault' - Combos are locked to near combos for " + ESduration+" combos";
	}
	ESduration--;
}
	
function randomCombo() {
let comboname;
if (phase == 1){
const keys = Object.keys(p1Combos); 
	comboname = p1Combos;
}
else if (phase == 2){
        comboname = p2Combos;
}
else if (phase == 3){
        comboname = p3Combos;
}
else if (phase == 4){
	comboname = p4Combos;
	timerP = 160;
	if (p4initial !== "done"){
	timerP = 210;
	comboname = p4Initials;
	p4initial = "done";
	}
}
	
	
	let Ckeys = Object.keys(comboname); 
	const half = Math.ceil(Ckeys.length / 2);
	if (ESFarstate == true){
		Ckeys = Ckeys.slice(0, half);
		console.log(Ckeys);
	}
	else if (ESNearstate == true){
		Ckeys = Ckeys.slice(half, Ckeys.length);
		console.log(Ckeys);
	}
	const randomKey = Ckeys[Math.floor(Math.random() * Ckeys.length)];
	currentCombo = comboname[randomKey];
		EveningShade();
		EvilFracture();
		timerP += 40;
	}


	function timefracturing(){
	if(guess.includes("EF")||!currentCombo.includes("EF")){
		clearInterval(intervalId4);
		document.getElementById("timerstatus").textContent = "";
		return;
	}
if (timer <= 10){
clearInterval(intervalId4);
}
timer -= 1;
document.getElementById("timer").textContent = timer/10;
document.getElementById("timerstatus").style.color = "#5d00ff";
document.getElementById("timerstatus").textContent = " Fractured Time! (2x Speed)";
}

///
function attack(name, code){
if (state == "stop") {
    return;
 }
if (counter == true){
Counterattack();}
if (code == "SR"){
if (SRcd !== true){
ShadowRiposte();
}
else{
return;}}

guessattempt = true;
if (document.getElementById("atk").textContent === " "){
document.getElementById("atk").textContent += name;}
else{
document.getElementById("atk").textContent += " > " + name;}
guess.push(code);
guessattempt = false;
}
randomCombo();
function check(){
console.log("guess:", JSON.stringify(guess));
console.log("current:", JSON.stringify(currentCombo));
if (state == "stop"){
return;
}
ans = 1;
for(n=0; n <= guess.length; n++){
if (guess[n] !== currentCombo[n]){
ans = 0;
break;
}
}
if (ans === 1){
cleanse();
damagemultiplier = ((timerP - (timerP - timer)) / timerP) * 2
damagenumber = Math.floor(350000 + (350000 * damagemultiplier));
damagecarn(damagenumber);
msg.textContent = "Correct!";
damagedisplay.textContent = " (Damage dealt: "+damagenumber+") ";
damagemultidisplay.textContent = "(" + (1+damagemultiplier) + "x)";

setTimeout(function (){
damagedisplay.textContent = "";
damagemultidisplay.textContent = ""; 
}, 3000)
}
else{
msg.textContent = "wrong lozer";


if (venom > 0){
console.log("activated");
lifelost += 1;
cleanse();
}

if (currentCombo.includes("Romeida")){
venomfunction(1);
}

if (currentCombo.includes("SF")){
burnfunction(1);
}

if (currentCombo.includes("Decap")){
lifelost += 3;
lifenews.style.color = "#8e0000";
lifenews.textContent += " Decapitated! (-3 Lives)"
setTimeout(function (){lifenews.textContent = lifenews.textContent.slice(0, 0);
}, 3000)
}
else{
lifelost += 1;
}
lnumber = lnumber - lifelost;
lifenumber.textContent = lnumber;
}
timer = 40;
state = "stop";
lifelost = 0;
}

function imgcombo(combo){
	i = 0;
const container = document.getElementById("imgattack");
var imageUrl;
function wait (){intervalId2 = setInterval(imgs, intervalP);}
function imgs(){
let atkname = combo[i];
const newImg = document.createElement('img');
if (i >= currentCombo.length-1){
clearInterval(intervalId2);
}
if (atkname == "SS"){
console.log("ss");
var imageUrl = 'images/SS.webp';
}
else if (atkname == "Decap"){
console.log("decap")
var imageUrl = 'images/DECAP.webp';
}
else if (atkname == "VV"){
var imageUrl = 'images/VV.webp';
}
else if (atkname == "Dash"){
var imageUrl = 'images/DASH.webp';
}
else if (atkname== "Fakeout"){
var imageUrl = 'images/FAKEOUT.webp';
}
else if (atkname == "TR"){
var imageUrl = 'images/TR.webp';
}
else if (atkname == "WF"){
var imageUrl = 'images/WF.webp';
}
else if (atkname == "SF"){
var imageUrl = 'images/SF.webp';
}
else if (atkname == "DS"){
var imageUrl = 'images/DS.webp';
}
else if (atkname == "DR"){
var imageUrl = 'images/DR.webp';
}
else if (atkname == "SV"){
var imageUrl = 'images/SV.webp';
}
else if (atkname == "Summon"){
var imageUrl = 'images/SUMMON.webp';
}
else if (atkname == "Redirect"){
var imageUrl = 'images/REDIRECT.webp';
}
else if (atkname == "Mawaru"){
var imageUrl = 'images/MAWARU.webp';
}
else if (atkname == "BD"){
var imageUrl = 'images/BD.webp';
}
else if (atkname == "Romeida"){
var imageUrl = 'images/ROMEIDA.webp';
}
else if (atkname == "DB"){
var imageUrl = 'images/DB.webp';
}
else if (atkname == "ES"){
var imageUrl = 'images/ES.webp';
}
else if (atkname == "SR"){
var imageUrl = 'images/SR.webp';
}
else if (atkname == "EF"){
var imageUrl = 'images/EF.webp';
}
newImg.onload = function(){
container.appendChild(newImg);
};
newImg.src = imageUrl;
newImg.width = 75;
newImg.height = 75;
console.log(i)
i++;

}
wait();
}
function backspace (){
guess.pop()
  const atkEl = document.getElementById("atk");

  let names = atkEl.textContent.trim().split(" > ");

  names.pop();

  atkEl.textContent = names.length ? names.join(" > ") : " ";
}

function clearcombo(){
console.log("cleared");
document.getElementById("atk").textContent = " ";
guess.length = 0;
}
imgcombo(currentCombo); ////testing

function reset(){
state = "right";
document.getElementById("timerstatus").textContent = ""
document.getElementById("imgattack").innerHTML = '';
timer = timerP;
if (currentCombo.includes("SR")) {timer += 40;}
timerloop();
}

function nextphase(){
phase += 1;
if (phase == 2){
phasechange2 = "done";
timerP = 120;
intervalP = 200;
dialogue.textContent = "Black Magic.";
setTimeout(function(){ dialogue.textContent = "";
}, 3000)
showButtons('SV');
showButtons('SF');
showButtons('DS');
showButtons('DR');
document.getElementById("phase2text").style.display = "inline-block";
}
if (phase == 3){
phasechange3 = "done";
timerP = 160;
intervalP = 200;
dialogue.textContent = "Sorcerer's Ancestry...";
setTimeout(function(){dialogue.textContent = "Dragonborn.";
}, 3000)
setTimeout(function(){dialogue.textContent = "";
}, 6000)

showButtons('BD');
showButtons('Summon');
showButtons('Redirect');
showButtons('Mawaru');
showButtons('Romeida');
document.getElementById("phase3text").style.display = "inline-block";
}

if (phase == 4){
phasechange4 = "done";
timerP = 160;
intervalP = 200;
dialogue.textContent = "...Insignificant.";
setTimeout(function(){dialogue.textContent = "Pest.";
}, 3000)
setTimeout(function(){dialogue.textContent = "I will not forget what I am here for.";
}, 6000)
setTimeout(function(){dialogue.textContent = "Remember, you brought this upon yourself.";
}, 9000)
setTimeout(function(){dialogue.textContent = "";
}, 12000)

showButtons('EF');
showButtons('ES');
showButtons('SR');
showButtons('DB');
document.getElementById("phase4text").style.display = "inline-block";
}


}
function showButtons(name){
let button = document.getElementById(name);
button.style.display = "inline-block";
}
function damagecarn(x){
healthval -= x;
health.textContent = healthval;
if (healthval <= 11000000 && phasechange2 !== "done"){
nextphase();
}
if (healthval <= 9775000 && phasechange3 !== "done"){
nextphase();
}
if (healthval <= 6505000 && phasechange4 !== "done"){
nextphase();
}
}
function final(){
check();
clearcombo();
randomCombo();
reset();
imgcombo(currentCombo);
}



</script>































